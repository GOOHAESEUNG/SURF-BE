# Gemini 분석 서브 에이전트

Claude Code가 로컬 Gemini CLI를 서브 에이전트로 활용하여 분석 작업을 위임합니다.

## 개요

```
┌─────────────────────────────────────────┐
│            Claude Code (메인)            │
│         - 코드 작성, 수정, 실행           │
│         - 최종 판단 및 리포트             │
└─────────────────┬───────────────────────┘
                  │ 필요시 호출
                  ▼
┌─────────────────────────────────────────┐
│       Gemini CLI (서브 에이전트)          │
│         - 대규모 코드 분석               │
│         - 최신 기술 정보 검색            │
│         - 로그/데이터 전처리             │
└─────────────────────────────────────────┘
```

## 호출 조건 (자동 판단)

### Gemini 호출 O

| 상황 | 이유 |
|------|------|
| 파일 10개 이상 분석 | Claude 컨텍스트 부족 |
| 전체 코드베이스 파악 필요 | 프로젝트 루트에서 실행 |
| 최신 라이브러리 버전 확인 | Gemini 웹 검색 활용 |
| 대용량 로그 파싱/요약 | 전처리 후 결과만 활용 |
| 실시간 기술 트렌드 | 웹 검색 필요 |

### Gemini 호출 X

| 상황 | 이유 |
|------|------|
| 단일 파일 수정 | Claude 단독 처리 가능 |
| 간단한 코드 작성 | 불필요한 오버헤드 |
| 이미 파악한 내용 | 컨텍스트 내 해결 |
| 빠른 응답 필요 | API 호출 시간 절약 |

## 사용 명령어

> **중요**: 프로젝트 루트 디렉토리에서 실행해야 합니다. `-y` 옵션은 YOLO 모드로, tool call을 자동 승인합니다.

### 대규모 코드 분석

```bash
# 프로젝트 루트로 이동 후 실행
cd /path/to/project

# 전체 아키텍처 분석
gemini "이 프로젝트의 아키텍처를 분석하고 주요 컴포넌트 간 의존성을 설명해줘" -y

# 특정 패턴 분석
gemini "모든 Controller에서 사용하는 공통 패턴을 찾아줘" -y

# 리팩토링 포인트 분석
gemini "코드 중복이나 개선이 필요한 부분을 찾아줘" -y
```

### 최신 기술 정보

```bash
# 라이브러리 최신 버전
gemini "Spring Boot 3.x의 최신 버전과 주요 변경사항을 알려줘" -y

# 베스트 프랙티스
gemini "2024년 기준 JWT 인증 구현 베스트 프랙티스를 알려줘" -y

# 마이그레이션 가이드
gemini "Java 17에서 21로 마이그레이션할 때 주의사항을 알려줘" -y
```

### 로그/데이터 전처리

```bash
# 에러 로그 분석 (stdin으로 전달)
cat error.log | gemini "이 로그에서 에러 패턴을 분석하고 원인을 추정해줘" -y

# JSON 데이터 변환
cat data.json | gemini "이 데이터를 분석하고 CSV 형식으로 변환해줘" -y

# 대용량 파일 요약
cat large-file.txt | gemini "이 내용을 핵심만 요약해줘" -y
```

## 워크플로우

### 1. 코드베이스 분석 요청 시

```
사용자: "이 프로젝트 구조 분석해줘"
    │
    ▼
Claude: 파일 개수 확인
    │
    ├─ 10개 미만 → Claude 직접 분석
    │
    └─ 10개 이상 → Gemini 호출
                      │
                      ▼
               cd project && gemini "..." -y
                      │
                      ▼
               Gemini 결과 수신
                      │
                      ▼
               Claude가 정리하여 리포트
```

### 2. 최신 정보 필요 시

```
사용자: "Spring Security 6 설정 방법 알려줘"
    │
    ▼
Claude: 최신 정보 필요 판단
    │
    ▼
gemini "Spring Security 6 최신 설정 방법과 예시" -y
    │
    ▼
Gemini 결과 수신
    │
    ▼
Claude가 프로젝트에 맞게 코드 작성
```

### 3. 대용량 로그 분석 시

```
사용자: "이 에러 로그 분석해줘" (10MB 로그)
    │
    ▼
Claude: 대용량 판단
    │
    ▼
cat error.log | gemini "에러 패턴 분석" -y
    │
    ▼
Gemini: 주요 에러 5개 요약 반환
    │
    ▼
Claude가 각 에러에 대한 해결책 제시
```

## 결과 활용

### Gemini 결과 → Claude 처리

```
Gemini 출력:
"프로젝트는 3-tier 아키텍처로 구성되어 있으며,
 Controller → Service → Repository 패턴을 따릅니다.
 주요 도메인: User, Order, Product..."

Claude 처리:
1. 결과 검증 및 보완
2. 프로젝트 맥락에 맞게 재해석
3. 코드 수정 또는 리포트 작성
4. 사용자에게 최종 전달
```

## 장점

| 항목 | 설명 |
|------|------|
| 컨텍스트 절약 | 대규모 분석을 Gemini에 위임 |
| 최신 정보 | Gemini 웹 검색 활용 |
| 전처리 | 대용량 데이터 요약 후 활용 |
| 비용 효율 | Claude 토큰 절약 |

## 주의사항

1. **Gemini Rate Limit**: 연속 호출 시 429 에러 가능 → 간격 두기
2. **결과 검증**: Gemini 결과를 그대로 사용하지 않고 Claude가 검증
3. **민감 정보**: API 키 등 민감 정보는 Gemini에 전달하지 않음
4. **오프라인**: 네트워크 없으면 Gemini 사용 불가 → Claude 단독 처리
